FROM node:18-alpine

WORKDIR /app

# Build args for Vite env variables
ARG VITE_ENVIRONMENT_TYPE=production
ARG VITE_BACKEND_URL_PROD
ARG VITE_FRONTEND_URL_PROD
ARG VITE_BACKEND_URL_DEV
ARG VITE_FRONTEND_URL_DEV

# Copy and install
COPY package*.json ./
RUN npm install

# Copy source and build
COPY . .
RUN npm run build

# Install serve and cleanup
RUN npm install -g serve && \
    npm prune --production

EXPOSE 3000

CMD ["serve", "-s", "dist", "-l", "3000"]